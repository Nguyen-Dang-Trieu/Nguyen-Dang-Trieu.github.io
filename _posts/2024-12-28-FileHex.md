---
title: File Hex
date: 2024-12-28
categories: ['Computer']
tags: ['Assembly']
author: Trieu
image:
  path: assets/headers/2024-12-28-hex-code.png
  alt: Hex Code
---

# File hex là gì
\- Các file có đuôi <kbd>*.hex</kbd> được gọi là file HEX. Hex là 1 tiêu chuẩn do Intel quy định. Tên đầy đủ của hex là Interl HEX. Loại file này thường được sử dụng để truyền các chương trình và dữ 
liệu sẽ được lưu trữ trong ROM hoặc EEPROM. Nó là một file văn bản ASCII (2 kí tự mã ASCII biểu thị 1 byte Hex) bao gồm các dòng văn bản phù hợp với định dạng file Intel HEX.

\- File này chủ yếu được sử dụng để lưu firmware cho vi điều khiển.

# Đinh dạng file Hex
Dưới đây là hình ảnh minh họa về 1 file.hex

![Hex Code](/assets/articles/2024/HexFile/2024-12-28-example.png){: .normal }
_Example Hex Code_

Mỗi dòng sẽ tuân theo **Format** sau

![Format Code](/assets/articles/2024/HexFile/2024-12-28-FormatCode.png){: .normal }
_Format Code_

- `Start code`: mỗi dòng được coi là 1 frame, và được bắt đầu bằng dấu hai chấm " : ".
- `Byte count`: Hai chữ số thập lục phân cho biết số byte trong Data. Số byte tối đa là `255 (0xFF)`, `16 (0x10)` và `32 (0x20)` là các byte thường được sử dụng.
- `Address`: Bốn chữ số thập lục phân cho biết độ lệch (offset) địa chỉ. Địa chỉ vật lí của dữ liệu được tính bằng cách thêm phần offset này vào địa chỉ cơ sở.
- `Record type`: Hai chữ số thập lục phân từ 0x00 -> 0x05.

| Command | Description |
| --- | --- |
| 0x00 | Data record | |
| 0x01 | End of File Record | 
| 0x02 | Extended Segment Address Record | 
| 0x03 | Start Segment Address Record | 
| 0x04 | Extended Linear Address Record |
| 0x05 | Start Linear Address Record |

- `Data`: chuỗi dữ liệu n-byte.
- `Checksum`: Hai chữ số thập lục phân được sử dụng để xác minh rằng giá trị tính toán được ghi không có lỗi.

##### **Example 1**: `:10000000A8990020C1010408830B040839080408DA`.
![Difference File Bin and File Hex](/assets/articles/2024/HexFile/2024-12-28-Example1.png){: .normal }

- `:`: Bắt đầu.
- `0x10`: Số byte data = 16.
- `0x00`, `0x00`: Địa chỉ offset nơi để lưu dữ liệu. (Ta có thể hiểu là `0x0000`)
- `0x00`: Kiểu dữ liệu.
- `0xA8` , `0x99`, `0x00`, `0x20`, `0xC1`, `0x01`, `0x04`, `0x08`, `0x83`, `0x0B`, `0x04`, `0x08`, `0x39`, `0x08`, `0x04`, `0x08`: Data (Tổng cộng có 16 bytes).
- Byte Check sum = `0xDA`.
  
Để có thể kiểm tra lỗi trong frame thì: 
  - B1: Tổng giá trị các byte có trong frame = `0x10` + `0x00` + `0x00` + `0x00` + `0xA8` + ... + `0x04` + `0x08` = `0x326`
  - B2: Lấy byte cuối cùng = `0x26`. 
  - B3: Tổng checksum = (`0x100` - byte cuối) & `0xFF` = (`0x100` - `0x26`) & `0xFF` = `0xDA` -> Ta thấy được ở cuối frame cũng là `0xDA` nên frame này không có `ERROR`.
    
##### **Example 2**: `:00000001FF`. 
Đây là dòng cuối cùng trong hình ảnh bên trên.
- `:`: Bắt đầu.
- `0x00`: Số byte data = 0.
- `0x00`, `0x00`: Địa chỉ offset nơi để lưu dữ liệu.
- `0x01`: End of File Record --> Kết thuc file HEX. 

# Sự khác biệt giữa File.hex và File.bin
## 1. Cách sử dụng
- File `*.hex`: Khi lập trình và tải xuống file Hex, người dùng không cần phải chỉ định địa chỉ vì thông tin bên trong File Hex đã bao gồm địa chỉ.
- File `*.bin`: Khi ghi file BIN, người dùng cần phải chỉ định địa chỉ do File Bin chỉ có phần `DATA` trong file HEX.
![Difference File Bin and File Hex](/assets/articles/2024/HexFile/2024-12-28-HexBin.png){: .normal }

> Trái là File.hex - Phải là File.bin.
{: .prompt-warning }

## 2. Kích thước File
Như đầu bài viết tôi có đề cập: *File.hex là một file văn bản ASCII*. Mỗi kí tự trong file Hex sẽ có kích thước là 1 byte.

=> **File Hex** ít nhất phải có kích thước lớn hơn gấp đôi so với **File Bin**.

Để dễ hiểu hơn thì tôi sẽ lấy ví dụ từ hình so sánh bên trên.
- `46`: Trong file Hex sẽ bao gồm 2 kí tự là `4` và `6`. Tra bảng mã ASCII ta được: `0x34` và `0x36` => Cần `2 bytes` để biểu diễn `0x46`.
- `46`: Trong file Bin thì chỉ cần `1 byte` = `0x46`.
  
**Suy ra**: 
  - *File Hex* có 10 bytes data thì phải dùng ít nhất `20 byte` (chưa kể các bytes để mô tả `Address`, `Byte count`, ...) để biểu diễn.
  - *File Bin* thì cũng chỉ cần `10 byte` là đủ.

# 🌏 Reference
- https://scienceprog.com/shelling-the-intel-8-bit-hex-file-format/
