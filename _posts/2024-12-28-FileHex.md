---
title: File Hex
date: 2024-12-28
categories: ['Computer']
tags: ['Assembly']
author: Trieu
image:
  path: assets/headers/2024-12-28-hex-code.png
  alt: Hex Code
---

## I. File hex l√† g√¨
\- C√°c file c√≥ ƒëu√¥i <kbd>*.hex</kbd> ƒë∆∞·ª£c g·ªçi l√† file HEX. Hex l√† 1 ti√™u chu·∫©n do Intel quy ƒë·ªãnh. T√™n ƒë·∫ßy ƒë·ªß c·ªßa hex l√† Interl HEX. Lo·∫°i file n√†y th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ truy·ªÅn c√°c ch∆∞∆°ng tr√¨nh v√† d·ªØ 
li·ªáu s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ trong ROM ho·∫∑c EEPROM. N√≥ l√† m·ªôt file vƒÉn b·∫£n ASCII (2 k√≠ t·ª± m√£ ASCII bi·ªÉu th·ªã 1 byte Hex) bao g·ªìm c√°c d√≤ng vƒÉn b·∫£n ph√π h·ª£p v·ªõi ƒë·ªãnh d·∫°ng file Intel HEX.

\- File n√†y ch·ªß y·∫øu ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u firmware cho vi ƒëi·ªÅu khi·ªÉn.

## II. ƒêinh d·∫°ng file Hex
D∆∞·ªõi ƒë√¢y l√† h√¨nh ·∫£nh minh h·ªça v·ªÅ 1 file.hex

![Hex Code](/assets/articles/2024/HexFile/2024-12-28-example.png){: .normal }
_Example Hex Code_

M·ªói d√≤ng s·∫Ω tu√¢n theo **Format** sau

![Format Code](/assets/articles/2024/HexFile/2024-12-28-FormatCode.png){: .normal }
_Format Code_

- `Start code`: m·ªói d√≤ng ƒë∆∞·ª£c coi l√† 1 frame, v√† ƒë∆∞·ª£c b·∫Øt ƒë·∫ßu b·∫±ng d·∫•u hai ch·∫•m " : ".
- `Byte count`: Hai ch·ªØ s·ªë th·∫≠p l·ª•c ph√¢n cho bi·∫øt s·ªë byte trong Data. S·ªë byte t·ªëi ƒëa l√† `255 (0xFF)`, `16 (0x10)` v√† `32 (0x20)` l√† c√°c byte th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng.
- `Address`: B·ªën ch·ªØ s·ªë th·∫≠p l·ª•c ph√¢n cho bi·∫øt ƒë·ªô l·ªách (offset) ƒë·ªãa ch·ªâ. ƒê·ªãa ch·ªâ v·∫≠t l√≠ c·ªßa d·ªØ li·ªáu ƒë∆∞·ª£c t√≠nh b·∫±ng c√°ch th√™m ph·∫ßn offset n√†y v√†o ƒë·ªãa ch·ªâ c∆° s·ªü.
- `Record type`: Hai ch·ªØ s·ªë th·∫≠p l·ª•c ph√¢n t·ª´ 0x00 -> 0x05.

| Command | Description |
| --- | --- |
| 0x00 | Data record | |
| 0x01 | End of File Record | 
| 0x02 | Extended Segment Address Record | 
| 0x03 | Start Segment Address Record | 
| 0x04 | Extended Linear Address Record |
| 0x05 | Start Linear Address Record |

- `Data`: chu·ªói d·ªØ li·ªáu n-byte.
- `Checksum`: Hai ch·ªØ s·ªë th·∫≠p l·ª•c ph√¢n ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c minh r·∫±ng gi√° tr·ªã t√≠nh to√°n ƒë∆∞·ª£c ghi kh√¥ng c√≥ l·ªói.

**Example 1**: `:10000000A8990020C1010408830B040839080408DA`.

![Difference File Bin and File Hex](/assets/articles/2024/HexFile/2024-12-28-Example1.png){: .normal }

- `:`: B·∫Øt ƒë·∫ßu.
- `0x10`: S·ªë byte data = 16.
- `0x00`, `0x00`: ƒê·ªãa ch·ªâ offset n∆°i ƒë·ªÉ l∆∞u d·ªØ li·ªáu. (Ta c√≥ th·ªÉ hi·ªÉu l√† `0x0000`)
- `0x00`: Ki·ªÉu d·ªØ li·ªáu.
- `0xA8` , `0x99`, `0x00`, `0x20`, `0xC1`, `0x01`, `0x04`, `0x08`, `0x83`, `0x0B`, `0x04`, `0x08`, `0x39`, `0x08`, `0x04`, `0x08`: Data (T·ªïng c·ªông c√≥ 16 bytes).
- Byte Checksum = `0xDA`.
  
ƒê·ªÉ c√≥ th·ªÉ ki·ªÉm tra l·ªói trong frame th√¨: 
  - B1: T·ªïng gi√° tr·ªã c√°c byte c√≥ trong frame = `0x10` + `0x00` + `0x00` + `0x00` + `0xA8` + ... + `0x04` + `0x08` = `0x326`
  - B2: L·∫•y byte cu·ªëi c√πng = `0x26`. 
  - B3: T·ªïng checksum = (`0x100` - byte cu·ªëi) & `0xFF` = (`0x100` - `0x26`) & `0xFF` = `0xDA` -> Ta th·∫•y ƒë∆∞·ª£c ·ªü cu·ªëi frame c≈©ng l√† `0xDA` n√™n frame n√†y kh√¥ng c√≥ `ERROR`.
    
**Example 2**: `:00000001FF`. 

ƒê√¢y l√† d√≤ng cu·ªëi c√πng trong h√¨nh ·∫£nh b√™n tr√™n.
- `:`: B·∫Øt ƒë·∫ßu.
- `0x00`: S·ªë byte data = 0.
- `0x00`, `0x00`: ƒê·ªãa ch·ªâ offset n∆°i ƒë·ªÉ l∆∞u d·ªØ li·ªáu.
- `0x01`: End of File Record --> K·∫øt thuc file HEX.
- Data: `None`
- Byte Checksum = `0xFF`

## III. S·ª± kh√°c bi·ªát gi·ªØa File.hex v√† File.bin
### 1. C√°ch s·ª≠ d·ª•ng
- File `*.hex`: Khi l·∫≠p tr√¨nh v√† t·∫£i xu·ªëng file Hex, ng∆∞·ªùi d√πng kh√¥ng c·∫ßn ph·∫£i ch·ªâ ƒë·ªãnh ƒë·ªãa ch·ªâ v√¨ th√¥ng tin b√™n trong File Hex ƒë√£ bao g·ªìm ƒë·ªãa ch·ªâ.
- File `*.bin`: Khi ghi file BIN, ng∆∞·ªùi d√πng c·∫ßn ph·∫£i ch·ªâ ƒë·ªãnh ƒë·ªãa ch·ªâ do File Bin ch·ªâ c√≥ ph·∫ßn `DATA` trong file HEX.
![Difference File Bin and File Hex](/assets/articles/2024/HexFile/2024-12-28-HexBin.png){: .normal }

> Tr√°i l√† File.hex - Ph·∫£i l√† File.bin.
{: .prompt-warning }

### 2. K√≠ch th∆∞·ªõc File
Nh∆∞ ƒë·∫ßu b√†i vi·∫øt t√¥i c√≥ ƒë·ªÅ c·∫≠p: *File.hex l√† m·ªôt file vƒÉn b·∫£n ASCII*. M·ªói k√≠ t·ª± trong file Hex s·∫Ω c√≥ k√≠ch th∆∞·ªõc l√† 1 byte.

=> **File Hex** √≠t nh·∫•t ph·∫£i c√≥ k√≠ch th∆∞·ªõc l·ªõn h∆°n g·∫•p ƒë√¥i so v·ªõi **File Bin**.

ƒê·ªÉ d·ªÖ hi·ªÉu h∆°n th√¨ t√¥i s·∫Ω l·∫•y v√≠ d·ª• t·ª´ h√¨nh so s√°nh b√™n tr√™n.
- `46`: Trong file Hex s·∫Ω bao g·ªìm 2 k√≠ t·ª± l√† `4` v√† `6`. Tra b·∫£ng m√£ ASCII ta ƒë∆∞·ª£c: `0x34` v√† `0x36` => C·∫ßn `2 bytes` ƒë·ªÉ bi·ªÉu di·ªÖn `0x46`.
- `46`: Trong file Bin th√¨ ch·ªâ c·∫ßn `1 byte` = `0x46`.
  
**Suy ra**: 
  - *File Hex* c√≥ 10 bytes data th√¨ ph·∫£i d√πng √≠t nh·∫•t `20 byte` (ch∆∞a k·ªÉ c√°c bytes ƒë·ªÉ m√¥ t·∫£ `Address`, `Byte count`, ...) ƒë·ªÉ bi·ªÉu di·ªÖn.
  - *File Bin* th√¨ c≈©ng ch·ªâ c·∫ßn `10 byte` l√† ƒë·ªß.
## IV. Practice
![ASM 8085](/assets/articles/2024/HexFile/2024-12-29-Practice.png){: .normal }
_Assembly of 8085_

Ch∆∞∆°ng tr√¨nh tr√™n d√πng ƒë·ªÉ c·ªông 2 s·ªë:
- `8101H`: ch·ª©a gi√° tr·ªã `05H` c·ªßa s·ªë ƒë·∫ßu ti√™n.
- `8102H`: ch·ª©a gi√° tr·ªã `03H` c·ªßa s·ªë th·ª© hai.

**Gi·∫£i th√≠ch asm**:
- `LXI H,8101`: n·∫°p gi√° tr·ªã `8101H` (16-bit) v√†o c·∫∑p thanh ghi H ch·ª©a `81H` (bit cao) v√† thanh ghi L ch·ª©a `01H` (bit th·∫•p). Thanh ghi HL ƒëang tr·ªè t·ªõi ƒë·ªãa ch·ªâ `8101H` l√† n∆°i ch·ª©a gi√° tr·ªã c·ªßa s·ªë ƒë·∫ßu ti√™n.
- `MOV A, M`: d√πng ƒë·ªÉ di chuy·ªÉn gi√° tr·ªã c·ªßa √¥ nh·ªõ t·∫°i ƒë·ªãa ch·ªâ m√† thanh ghi HL ƒëang tr·ªè t·ªõi `8101H` v√†o thanh ghi A -> Thanh ghi A hi·ªán t·∫°i c√≥ gi√° tr·ªã = `05H`.
- `LNX H`: tƒÉng gi√° tr·ªã thanh ghi HL l√™n 1 => V·ªã tr√≠ ti·∫øp theo m√† thanh ghi HL tr·ªè t·ªõi l√† `8102H` n∆°i ch·ª©a gi√° tr·ªã `03H` c·ªßa s·ªë th·ª© 2.
- `ADD M`: c·ªông gi√° tr·ªã t·∫°i v√≠ tr√≠ thanh ghi HL ƒëang tr·ªè t·ªõi `8102H` l√† `03H` v·ªõi gi√° tr·ªã ƒë√£ c√≥ s·∫µn trong thanh ghi A `05H` => Gi√° tr·ªã cu·ªëi c√πng `08H` ƒë∆∞·ª£c l∆∞u trong thanh ghi A.
- `STA 8103`: l∆∞u n·ªôi dung c·ªßa thanh ghi A v√†o ƒë·ªãa ch·ªâ `8103H`. ƒê√¢y l√† n∆°i l∆∞u tr·ªØ gi√° tr·ªã `08H` k·∫øt qu·∫£ c·ªßa ph√©p c·ªông 2 s·ªë `03H` v√† `05H`.
- `RST 3`: nh·∫£y ƒë·∫øn d·ªãa ch·ªâ vector ng·∫Øt ƒë·ªÉ th·ª±c hi·ªán ch∆∞∆°ng tr√¨nh con or k·∫øt th√∫c.   

Nh·ªØng c√¢u l·ªánh `ASM` tr√™n th√¨ cho con ng∆∞·ªùi hi·ªÉu nh∆∞ng ƒë·ªÉ **CPU** hi·ªÉu th√¨ c·∫ßn ph·∫£i chuy·ªÉn `ASM` sang `HEX`. ƒê·ªÉ th·ª±c hi·ªán vi·ªác n√†y ta d√πng `OPCODE`. (*Tham kh·∫£o Opcode table c·ªßa 8085*)
- `LXI H,8101` -> Hex Code: `21, 81, 01`
    - `LXI` c√≥ opcode: `21H`
    - `81, 01`: gi√° tr·ªã c·ªßa l·ªánh OPCODE n√†y
- `MOV A, M` -> Hex Code: `7E`
    - `MOV` c√≥ opcode: `7E`.

![OPCODE table of 8085](/assets/articles/2024/HexFile/2024-12-29-OpcodeTable.png){: .normal }
_Opcode Table of 8085_

## üåè Reference
- https://scienceprog.com/shelling-the-intel-8-bit-hex-file-format/
- [Opcode 8085](https://fr.scribd.com/document/92351358/8085-OPCODES)
